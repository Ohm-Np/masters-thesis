---
title: 'vector operations: mapme.biodiversity functions'
author: "Om Prakash Bhandari"
date: "07/06/2022"
output: workflowr::wflow_html
---

## Introduction 

The study that we are going to carry out here uses functions from `mapme.biodiversity` to process polygon data. 

Dataset: Mangrove Extent (2016)
Source: Global Mangrove Watch (GMW)
AOIs: WDPA polygons, simplified WDPA polygons and Fishnet polygons


## Plot 

```{r df, message=FALSE, warning=FALSE, include=FALSE}
library(dplyr)
df <- read.csv("data/results/mapme_biodiversity/mangrove_1-16.csv")
df.long <- tidyr::pivot_longer(df,
                               cols = c("WDPA_7495", "Simplified_WDPA_7495", "Fishnet_216425"))
# rename column name
df.long <- df.long %>%
  rename(Resource = name)
library(ggplot2)
result <- ggplot(df.long, aes(Cores, value)) +
  geom_line(aes(colour = Resource))+
  theme_classic() +
  theme(panel.grid.major.y = element_line(), plot.title = element_text(size = rel(1.25), hjust = 0.5),
        plot.caption = element_text(size = rel(0.7), hjust = 1.3, face = "italic")) +
  labs(title = "Time taken to process mangrove polygon using multiple cores (WDPA)",
       caption = "Source: Global Mangrove Watch (2016)") +
  ylab("Time elapsed (s)")+
  xlab("Number of cores")+
  geom_point(colour = "red", size = 0.5) +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 16.5)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 4500))
```

The graph below shows us how the order of the polygons during intersection influence the processing time.

```{r plot, message=FALSE, warning=FALSE, include=TRUE, fig.width=10}

result
```

### Factor plot (WDPA)

We already saw how using the different number of cores affect the processing time and it follows more or less exponential pattern. Now, we want to see the plot showing factor by which the processing time increases with increase in the number of cores.

```{r fct, message=FALSE, warning=FALSE, include=FALSE}

library(dplyr)
orig.data <-
  read.csv("data/results/mapme_biodiversity/mangrove_1-16.csv")
# change the df to the factor numbers
dftofct <- function(n) {

  fct <- orig.data[[3]][1]/orig.data[[3]][n]
  newdf <- data.frame(Cores = n,
                      obtained = fct,
                      hypothetical = n)
}
listed <- lapply(1:16, dftofct)
final <- do.call(rbind, listed)

# create line plot from the final data
long <- tidyr::pivot_longer(final,
                            cols = c("hypothetical", "obtained"))
# rename name to Factor
long <- long %>%
  rename(Factor = name)

fct_plot <- ggplot(long, aes(x = Cores, y = value, group = Factor)) +
  geom_line(aes(linetype = Factor, color = Factor)) +
  geom_point(colour = "red", size = 0.5) +
  theme_classic() +
  theme(panel.grid.major.y = element_line(),
        plot.title = element_text(size = rel(1.25), hjust = 0.5),
        plot.subtitle = element_text(size = rel(1.1), hjust = 0.5)) +
  labs(title = "Absolute factor plot (WDPA polygons)",
       subtitle = "(Mangrove extent 2016)") +
  scale_linetype_manual(values = c("dotted", "solid")) +
  ylab("Factor") +
  xlab("Number of cores") +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 16.5)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 16.5))
```


```{r fctplot, message=FALSE, warning=FALSE, include=TRUE, fig.width=12}

fct_plot
```
